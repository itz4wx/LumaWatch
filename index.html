<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luma</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg: #1e1e1e; /* Standard Dark Theme for streaming sites */
            --bg-card: #2d2d2d;
            --bg-header: #111;
            --text: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent: #f1c40f; /* Optional gold/yellow accent if needed, but sticking to clean generic */
            --border: #333;
            --radius: 4px; /* Boxy style like gowo */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif; /* Simple font */
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }

        /* HEADER */
        .header {
            background: var(--bg-header);
            border-bottom: 1px solid #333;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-left { display: flex; align-items: center; gap: 20px; }
        .nav-links { display: flex; gap: 20px; font-size: 14px; font-weight: 500; }
        .nav-links a:hover { color: white; }
        
        .logo {
            font-weight: 900;
            font-size: 20px;
            color: #fff;
            text-transform: uppercase;
            margin-right: 20px;
        }
        
        .lang-select {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #777;
        }
        .lang-select span { cursor: pointer; }
        .lang-select span:hover, .lang-select span.active { color: #fff; }

        .nav-right { display: flex; align-items: center; gap: 15px; }

        /* MAIN LAYOUT */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        .section-title {
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .room-count { font-size: 14px; color: #777; align-self: center; }

        /* ROOM GRID */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .room-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            overflow: hidden;
            transition: transform 0.2s;
            position: relative;
            cursor: pointer;
        }
        .room-card:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        .card-thumb {
            position: relative;
            aspect-ratio: 2/3; /* Poster ratio */
            background: #000;
        }
        .card-thumb img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        
        .card-badges {
            position: absolute;
            top: 10px; left: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .badge {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 2px;
            text-transform: uppercase;
            font-weight: bold;
        }
        .badge-open { background: #27ae60; }
        .badge-watch { background: rgba(0,0,0,0.8); display: flex; align-items: center; gap: 4px; }

        .card-info { padding: 10px; }
        .card-title { font-size: 14px; font-weight: bold; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #fff; }
        .card-meta { font-size: 12px; color: #888; margin-bottom: 8px; }
        .card-creator { font-size: 12px; color: #aaa; display: flex; align-items: center; gap: 5px; }
        .rating { color: #f1c40f; font-size: 12px; margin-top: 5px; }

        /* FOOTER */
        .footer {
            background: #111;
            padding: 40px 20px;
            margin-top: 40px;
            border-top: 1px solid #333;
            color: #777;
            font-size: 13px;
        }
        .footer-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px; }
        .footer-links a { margin-right: 15px; }
        .footer-links a:hover { color: #fff; }

        /* UTILS */
        .btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .btn:hover { background: #444; }
        .btn-primary { background: #2980b9; }
        .btn-primary:hover { background: #3498db; }
        .input { background: #222; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; width: 100%; }

        /* ROOM PAGE SPECIFIC */
        .room-container { display: flex; height: calc(100vh - 60px); }
        .player-area { flex: 1; background: #000; display: flex; flex-direction: column; }
        .chat-area { width: 350px; background: #1a1a1a; border-left: 1px solid #333; display: flex; flex-direction: column; }
        .video-box { flex: 1; display: flex; align-items: center; justify-content: center; background: #000; position: relative; }
        .room-header-info { padding: 15px; background: #151515; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }

        .msg { padding: 8px 15px; font-size: 13px; line-height: 1.4; border-bottom: 1px solid #222; }
        .msg strong { color: #aaa; margin-right: 5px; }
        .chat-input-box { padding: 15px; background: #222; }

        /* AUTH PAGE */
        .auth-box { max-width: 400px; margin: 100px auto; background: #222; padding: 40px; border-radius: 4px; text-align: center; }
        
        /* Modals */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 999; display: none; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: #222; padding: 20px; border-radius: 4px; width: 400px; max-width: 90%; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="header">
        <div class="nav-left">
            <a href="#" class="logo" onclick="app.nav('home')">LUMA</a> <!-- Keeping name Luma but style of Gowo -->
            <div class="nav-links">
                <a href="#">Новости</a>
                <a href="#">Youtube</a>
                <a href="#">VK</a>
                <a href="#" onclick="app.openModal('create')">Создать комнату</a>
                <a href="#">Подписки</a>
            </div>
                </div>
        <div class="nav-right">
            <div class="lang-select">
                <span class="active">RU</span>
                <span>EN</span>
                <span>UK</span>
                <span>BY</span>
            </div>
            <div id="user-nav"></div>
        </div>
    </header>

    <main>
        <!-- HOME PAGE -->
        <div id="page-home" class="container">
            <div class="section-title">
                <span>Сейчас смотрят</span>
                <span class="room-count">Всего комнат: <span id="total-rooms">0</span></span>
            </div>

            <!-- Search/Filter placeholder like standard sites -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                <input type="text" id="search-input" class="input" style="width: 300px;" placeholder="Поиск пользователей...">
                <button class="btn" onclick="app.search()">Найти</button>
                <button class="btn btn-primary" onclick="app.openModal('create')">Создать</button>
                <input type="text" id="join-input" class="input" style="width: 150px;" placeholder="Код комнаты...">
                <button class="btn" onclick="app.joinByCode()">Войти</button>
            </div>

            <div id="rooms-grid" class="rooms-grid"></div>
            <div id="empty-msg" class="hidden" style="text-align: center; padding: 40px; color: #555;">Нет активных комнат</div>
        </div>

        <!-- ROOM PAGE -->
        <div id="page-room" class="hidden">
            <div class="room-container">
                <div class="player-area">
                    <div class="video-box">
                        <div style="text-align:center; color:#555;">
                            <i data-lucide="play" size="64"></i>
                            <br>Video Player
                        </div>
                    </div>
                    <div class="room-header-info">
                        <div>
                            <h2 style="font-size: 18px; margin-bottom: 5px;" id="r-title">Room Title</h2>
                            <div style="font-size: 12px; color: #777; display: flex; gap: 15px;">
                                <span>Создатель: <span id="r-creator">User</span></span>
                                <span>Время: <span id="r-time">00:00</span></span>
                                <span>Зрителей: <span id="r-viewers">0</span></span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="app.viewersModal()">Зрители</button>
                            <button class="btn" onclick="app.settingsModal()">Настройки</button>
                            <button class="btn btn-primary" onclick="app.invite()">Пригласить</button>
                            <button class="btn" style="background: #c0392b;" onclick="app.leave()">Выйти</button>
                        </div>
                    </div>
                </div>
                <div class="chat-area">
                    <div style="padding: 10px; background: #222; font-size: 12px; font-weight: bold; border-bottom: 1px solid #333;">ЧАТ КОМНАТЫ</div>
                    <div id="chat-box" style="flex: 1; overflow-y: auto;"></div>
                    <form class="chat-input-box" onsubmit="app.send(event)">
                        <input id="msg-input" type="text" class="input" placeholder="Написать сообщение..." autocomplete="off">
                            </form>
                </div>
            </div>
        </div>

        <!-- PROFILE -->
        <div id="page-profile" class="container hidden">
            <div style="background: #222; padding: 30px; display: flex; gap: 30px; border-radius: 4px;">
                <img id="p-avatar" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; background: #333;">
                <div style="flex: 1;">
                    <h1 id="p-name" style="margin-bottom: 10px;">Username</h1>
                    <div style="display: flex; gap: 20px; font-size: 14px; color: #888;">
                        <span>Часов: <b id="p-h" style="color:#fff">0</b></span>
                        <span>Комнат: <b id="p-r" style="color:#fff">0</b></span>
                        <span>Друзей: <b id="p-f" style="color:#fff">0</b></span>
                    </div>
                    <div style="margin-top: 20px;">
                         <button class="btn" onclick="app.openModal('edit-profile')">Редактировать</button>
                         <button class="btn" onclick="auth.logout()">Выйти</button>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px; background: #222; padding: 20px; border-radius: 4px;">
                <h3>Друзья</h3>
                <div id="p-friends" style="margin-top: 10px; color: #777;">Нет друзей</div>
            </div>
        </div>
        
        <!-- AUTH -->
        <div id="page-auth" class="hidden">
            <div class="auth-box">
                <h2 style="margin-bottom: 20px;">ВХОД</h2>
                <form onsubmit="auth.submit(event)" style="display: flex; flex-direction: column; gap: 15px;">
                    <input id="a-user" type="text" class="input" placeholder="Логин" required>
                    <input id="a-pass" type="password" class="input" placeholder="Пароль" required>
                    <button id="a-btn" type="submit" class="btn btn-primary">Войти</button>
                </form>
                <div style="margin-top: 15px; font-size: 13px;">
                    <a href="#" onclick="auth.toggle()" id="a-toggle">Регистрация</a>
                </div>
            </div>
        </div>

    </main>

    <footer class="footer">
        <div class="footer-content">
            <div>
                © Вce права защищены, материалы предоставляются только для ознакомления. 16+<br>
                2017-2025 luma.io
            </div>
            <div class="footer-links">
                <a href="#">Форма обратной связи</a>
                <a href="#">Для правообладателей</a>
                <a href="#">Пользовательское соглашение</a>
                <a href="#">Политика конфиденциальности</a>
            </div>
        </div>
    </footer>

    <!-- MODALS -->
    <div id="modal-create" class="modal-overlay">
        <div class="modal-content">
            <h3>Создать комнату</h3>
            <input id="c-name" type="text" class="input" style="margin: 15px 0;" placeholder="Название комнаты">
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" onclick="app.closeModal()">Отмена</button>
                <button class="btn btn-primary" onclick="app.createRoom()">Создать</button>
                </div>
                    </div>
                </div>

    <div id="modal-edit-profile" class="modal-overlay">
        <div class="modal-content">
            <h3>Редактировать</h3>
            <div style="display: flex; flex-direction: column; gap: 10px; margin: 15px 0;">
                <input id="e-avatar" class="input" placeholder="Ссылка на аватар">
                <input id="e-nick" class="input" placeholder="Никнейм">
                <input id="e-pass" type="password" class="input" placeholder="Новый пароль">
            </div>
            <button class="btn btn-primary" onclick="app.saveProfile()">Сохранить</button>
            <button class="btn" onclick="app.closeModal()">Закрыть</button>
        </div>
    </div>

    <div id="modal-viewers" class="modal-overlay">
        <div class="modal-content">
            <h3>Зрители</h3>
            <div id="v-list" style="max-height: 200px; overflow-y: auto; margin: 10px 0;"></div>
            <button class="btn" onclick="app.closeModal()">Закрыть</button>
        </div>
    </div>

    <script>
        const db = {
            get: (k,d) => JSON.parse(localStorage.getItem(k)||JSON.stringify(d)),
            set: (k,v) => localStorage.setItem(k,JSON.stringify(v)),
            users: () => db.get('users_db', {}),
            saveUsers: (v) => db.set('users_db', v),
            rooms: () => db.get('rooms_db', []),
            saveRooms: (v) => db.set('rooms_db', v)
        };

        let state = { user: db.get('curr_user', null), room: null };

        const auth = {
            init: () => {
                if(state.user) app.nav('home');
                else app.nav('auth');
                app.updateHeader();
            },
            isReg: false,
            toggle: () => {
                auth.isReg = !auth.isReg;
                document.querySelector('#page-auth h2').innerText = auth.isReg ? "РЕГИСТРАЦИЯ" : "ВХОД";
                document.getElementById('a-btn').innerText = auth.isReg ? "Зарегистрироваться" : "Войти";
                document.getElementById('a-toggle').innerText = auth.isReg ? "Войти" : "Регистрация";
            },
            submit: (e) => {
                e.preventDefault();
                const u = document.getElementById('a-user').value;
                const p = document.getElementById('a-pass').value;
                const users = db.users();
                if(auth.isReg) {
                    if(users[u]) return alert('Занято');
                    users[u] = { username: u, password: p, avatar: `https://api.dicebear.com/7.x/initials/svg?seed=${u}`, friends:[], stats:{h:0,r:0,f:0} };
                    db.saveUsers(users);
                    auth.login(users[u]);
                } else {
                    if(users[u] && users[u].password === p) auth.login(users[u]);
                    else alert('Ошибка');
                }
            },
            login: (u) => { state.user = u; db.set('curr_user', u); app.updateHeader(); app.nav('home'); },
            logout: () => { state.user = null; localStorage.removeItem('curr_user'); app.nav('auth'); }
        };

        const app = {
            init: () => {
                        lucide.createIcons();
                auth.init();
                setInterval(() => {
                    if(document.getElementById('page-home').style.display !== 'none') app.renderRooms();
                    if(state.room) app.updateTime();
                }, 4000);
            },
            nav: (p) => {
                ['home','room','profile','auth'].forEach(id => document.getElementById('page-'+id).classList.add('hidden'));
                document.getElementById('page-'+p).classList.remove('hidden');
                if(p==='home') app.renderRooms();
                if(p==='profile') app.renderProfile();
            },
            updateHeader: () => {
                const el = document.getElementById('user-nav');
                if(state.user) {
                    el.innerHTML = `
                        <a href="#" onclick="app.nav('profile')" style="display:flex;align-items:center;gap:10px;color:#fff;">
                            <img src="${state.user.avatar}" style="width:30px;height:30px;border-radius:50%;">
                            <span>${state.user.username}</span>
                        </a>
                    `;
                } else el.innerHTML = `<a href="#" onclick="app.nav('auth')">Войти</a>`;
            },
            
            // ROOMS
            createRoom: () => {
                const n = document.getElementById('c-name').value;
                if(!n) return;
                const r = {
                    id: Math.random().toString(36).substr(2,9),
                    code: Math.floor(100000+Math.random()*900000),
                    title: n, creator: state.user.username, start: Date.now(), viewers: 1
                };
                const rs = db.rooms(); rs.unshift(r); db.saveRooms(rs);
                state.user.stats.r++; app.saveUser();
                app.closeModal();
                app.enter(r);
            },
            joinByCode: () => {
                const c = document.getElementById('join-input').value;
                const r = db.rooms().find(x => x.code == c);
                if(r) app.enter(r); else alert('Не найдено');
            },
            enter: (r) => {
                state.room = r;
                document.getElementById('r-title').innerText = r.title;
                document.getElementById('r-creator').innerText = r.creator;
                document.getElementById('chat-box').innerHTML = '<div style="padding:10px;color:#777;text-align:center;">Добро пожаловать</div>';
                app.nav('room');
            },
            leave: () => { state.room = null; app.nav('home'); },
            renderRooms: () => {
                const rs = db.rooms();
                document.getElementById('total-rooms').innerText = rs.length;
                const grid = document.getElementById('rooms-grid');
                if(rs.length===0) { grid.innerHTML = ''; document.getElementById('empty-msg').classList.remove('hidden'); }
                else {
                    document.getElementById('empty-msg').classList.add('hidden');
                    grid.innerHTML = rs.map(r => `
                        <div class="room-card" onclick="app.enterById('${r.id}')">
                            <div class="card-thumb">
                                <img src="https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=300">
                                <div class="card-badges">
                                    <div class="badge badge-open">Открытая комната</div>
                                    <div class="badge badge-watch"><i data-lucide="play" size="8"></i> Смотрят: ${r.viewers}</div>
                                </div>
                            </div>
                            <div class="card-info">
                                <div class="card-title">${r.title}</div>
                                <div class="card-meta">Мелодрама, 2025</div>
                                <div class="card-creator">Создатель: ${r.creator}</div>
                                <div class="rating">★★★★☆</div>
                            </div>
                    </div>
                `).join('');
                    lucide.createIcons();
                }
            },
            enterById: (id) => {
                const r = db.rooms().find(x => x.id === id);
                if(r) app.enter(r);
            },
            
            // CHAT
            send: (e) => {
                e.preventDefault();
                const i = document.getElementById('msg-input');
                const v = i.value;
                if(!v) return;
                const b = document.getElementById('chat-box');
                const d = document.createElement('div');
                d.className = 'msg';
                d.innerHTML = `<strong style="color:${state.user.username === 'admin' ? 'red':'#aaa'}">${state.user.username}:</strong> ${v}`;
                b.appendChild(d);
                b.scrollTop = b.scrollHeight;
                i.value = '';
            },
            
            // MISC
            updateTime: () => {
                 const d = Math.floor((Date.now() - state.room.start)/1000);
                 const m = Math.floor(d/60).toString().padStart(2,'0');
                 const s = (d%60).toString().padStart(2,'0');
                 document.getElementById('r-time').innerText = m+':'+s;
            },
            invite: () => { alert('Код: '+state.room.code); },
            viewersModal: () => {
                const l = document.getElementById('v-list');
                l.innerHTML = `<div style="padding:5px;">${state.user.username} (Вы)</div>`;
                app.openModal('viewers');
            },

            // PROFILE
            renderProfile: () => {
                const u = state.user;
                document.getElementById('p-name').innerText = u.username;
                document.getElementById('p-avatar').src = u.avatar;
                document.getElementById('p-h').innerText = u.stats.h;
                document.getElementById('p-r').innerText = u.stats.r;
                document.getElementById('p-f').innerText = u.friends.length;
                document.getElementById('e-avatar').value = u.avatar;
                document.getElementById('e-nick').value = u.username;
            },
            saveProfile: () => {
                const ava = document.getElementById('e-avatar').value;
                const nick = document.getElementById('e-nick').value;
                if(ava) state.user.avatar = ava;
                // simplified nick change
                if(nick && nick !== state.user.username) state.user.username = nick;
                app.saveUser();
                    app.renderProfile();
                app.closeModal();
            },
            saveUser: () => {
                const us = db.users();
                us[state.user.username] = state.user;
                db.saveUsers(us);
                db.set('curr_user', state.user);
                app.updateHeader();
            },

            openModal: (id) => {
                document.querySelectorAll('.modal-overlay').forEach(x=>x.classList.remove('active'));
                document.getElementById('modal-'+id).classList.add('active');
            },
            closeModal: () => document.querySelectorAll('.modal-overlay').forEach(x=>x.classList.remove('active'))
        };

        window.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
